<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="mobile-web-app-capable" content="yes">
</head>

<body>
    
    <style type="text/css">
        .drag {
            width: 98px;
            height: 100px;
            line-height: 100px;
            border: 1px solid black;
            cursor: pointer;
            border-radius: 10px;
            text-align: center;
            background-color: lightpink;
            position: relative;
            left: 0px;
            top: 50px;
        }

        .container {
            background-color: lightblue;
            width: 100px;
            height: 200px;
            border: 1px solid black;
            float: left;
            margin-right: 30px;
        }
    </style>

    <br>

    <div id="not-connected">Not connected. Retry?</div>

    <div id="container-left" class="container">
        <div id="left" class="drag" style="left:0px;top:50px;">drag me</div>
    </div>

    <div id="container-right" class="container">
        <div id="right" class="drag" style="left:0px;top:50px;">drag me</div>
    </div>
    <script type="text/javascript" src="/static/jquery.min.js"></script>
    <script type="text/javascript" src="/static/jquery-ui.min.js"></script>
    <script type="text/javascript" src="/static/communication-handler.js"></script>
    <script>

        var revert = function (event, ui) {
            $(this).data("uiDraggable").originalPosition = {
                top: 50,
                left: 0
            };
            console.log("stop")
            return !event;
        };

        var drag = function (event, ui) {
            var $this = $(this);
            var thisPos = $this.position();
            var parentPos = $this.parent().position();

            var y = thisPos.top - parentPos.top;

            if (y < 50) {
                console.log("up")
            } else {
                console.log("down")
            }
        }

        var errorBlock = document.getElementById("not-connected");
        var path = `${location.protocol === 'https:' ? 'wss' : 'ws'}:\/\/${location.host + location.pathname}ws`;

        $(function () {

            $("#left").draggable({
                containment: "#container-left",
                revert: revert,
                drag: drag
            });

            $("#right").draggable({
                containment: "#container-right",
                revert: revert,
                drag: drag
            });

            errorBlock.onclick = function () {
                communication.reconnect();
            };
            
            var communication = communicationHandler(path, errorBlock);

            setTimeout(function () {
                communication.send('ceva')
            }, 500)
            
        });

    </script>
</body>

</html>